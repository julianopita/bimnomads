<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Documento sem t√≠tulo</title>
</head>

<body>
</body>
</html>
<canvas id="glcanvas" width="400" height="300" style="border:1px solid #000000;"></canvas>
<script src="gl-matrix.js"></script>
<script type="module">
/**
 * This class will return the API address for a BIMserver Client
 */

export class Address {
	static getApiAddress() {
		var pathname = document.location.pathname;
		if (pathname.length > 16 && pathname.indexOf("http://www.nomads.usp.br:8080/bimserver/apps/bimsurfer3/") != -1) {
			// We assume that BIMsurfer 3 is being served from a BIMserver and that this is also the BIMserver we would like to connect to
			const href = document.location.href;
			return href.substring(0, href.indexOf("http://www.nomads.usp.br:8080/bimserver/apps/bimsurfer3/"));
		} else {
			// Return a default
			console.log(document.location);
			return "http://localhost:8080/bimserver";
		}
	}
}
</script>
			 <script type="module">

import {BimServerClient} from "http://www.nomads.usp.br:8080/bimserver/apps/bimsurfer3/deps/bimserverjsapi/bimserverclient.js"
import {BimServerViewer} from "http://www.nomads.usp.br:8080/bimserver/apps/bimsurfer3/viewer/bimserverviewer.js"

/*
 * This class is where the minimal demo starts. This is intended as an example you can copy-and-paste to start integrating the viewer in your own application.
 */

export class Minimal {

	constructor() {
		// You need to change these to something that makes sense
		this.demoSettings = {
			// Address of your BIMserver
			//bimServerAddress: Address.getApiAddress(),
			bimServerAddress: "http://www.nomads.usp.br:8080/bimserver/",
			// Login credentials of your BIMserver, obviously you'd never include these for production applications
			bimServerLogin: {
				username: "admin@bimserver.org",
				password: "admin"
			},
			// Project ID of the project you want to load the latest revision from
			poid: 131073,
			// The settings for the viewer
			viewerSettings: {
				viewerBasePath: "http://www.nomads.usp.br:8080/bimserver/apps/bimsurfer3/"
				// Not putting anything here will just use the default settings
			}
		};
	}

	start() {
		// Connect to a BIMserver
		this.api = new BimServerClient(this.demoSettings.bimServerAddress);
		// Initialize the API
		this.api.init(() => {
			// Login
			this.api.login(this.demoSettings.bimServerLogin.username, this.demoSettings.bimServerLogin.password, () => {
				// Get the project details
				this.api.call("ServiceInterface", "getProjectByPoid", {
					poid: this.demoSettings.poid
				}, (project) => {
					// Select what canvas to bind the viewer to
					var canvas = document.getElementById("glcanvas");

					// Create a new BimServerViewer
					this.bimServerViewer = new BimServerViewer(this.api, this.demoSettings.viewerSettings, canvas, window.innerWidth, window.innerHeight);

					// Load the model
					this.bimServerViewer.loadModel(project);
				}, function(error) {
					console.error(error.message);
				});
			}, function() {
				console.error("Error logging-in, probably wrong username/password");
			});
		});
	}
}

new Minimal().start();
	</script>
